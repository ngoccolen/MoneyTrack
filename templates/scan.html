{% extends "base.html" %}
{% block content %}
<div class="dashboard-header">
    <h1>Quét Hóa Đơn tự động</h1>
</div>

<div class="row">
    <div class="col-6">
        <div class="card">
            <div id="camera-viewer" style="background: #000; border-radius: 12px; overflow: hidden; position: relative; min-height: 400px; display: flex; align-items: center; justify-content: center;">
                
                <video id="video" width="100%" autoplay playsinline style="display: block;"></video>
                
                <img id="photo-preview" src="" style="display: none; width: 100%; height: auto; object-fit: contain; cursor: pointer;" title="Nhấn để chụp lại">
                
                <canvas id="canvas" style="display:none;"></canvas>
                
                <div id="scan-overlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;">
                    <div class="scan-line" style="position: absolute; width: 100%; height: 3px; background: linear-gradient(to bottom, transparent, #00ff00, transparent); box-shadow: 0 0 15px #00ff00; animation: scanning 2s linear infinite;"></div>
                </div>
            </div>

            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button id="btn-capture" class="btn btn-primary" style="flex: 1;">Chụp & Quét</button>
                <input type="file" id="file-upload" hidden accept="image/*">
                <button onclick="document.getElementById('file-upload').click()" class="btn btn-secondary">Tải ảnh lên</button>
            </div>
            <p style="font-size: 12px; color: #64748b; margin-top: 10px; text-align: center;">
                Hãy nhấn vào ảnh để quay lại chế độ Camera
            </p>
        </div>
    </div>

    <div class="col-6">
        <div class="card">
            <h2 style="font-size: 1.25rem; margin-bottom: 15px;">Kết quả phân tích </h2>
            <hr style="border: 0; border-top: 1px solid #e2e8f0; margin-bottom: 20px;">
            
            <form action="{{ url_for('add_transaction') }}" method="POST" id="scan-result-form">
                <input type="hidden" name="transaction_type" value="expense">
                
                <div class="form-group">
                    <label style="font-weight: 600; color: #1e293b;">SỐ TIỀN (VNĐ)</label>
                    <input type="number" id="res-amount" name="amount" class="form-control" required placeholder="0" style="font-size: 1.2rem; font-weight: bold; color: #ef4444;">
                </div>

                <div class="form-group">
                    <label style="font-weight: 600; color: #1e293b;">NGÀY</label>
                    <input type="date" id="res-date" name="date" class="form-control" required>
                </div>

                <div class="form-group">
                    <label style="font-weight: 600; color: #1e293b;">DANH MỤC</label>
                    <select id="res-category" name="category" class="form-control" required>
                        <option value="Ăn uống">Ăn uống</option>
                        <option value="Di chuyển">Di chuyển</option>
                        <option value="Mua sắm">Mua sắm</option>
                        <option value="Nhà ở">Nhà ở</option>
                        <option value="Giải trí">Giải trí</option>
                        <option value="Khác" selected>Khác</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="font-weight: 600; color: #1e293b;">MÔ TẢ / GHI CHÚ</label>
                    <textarea id="res-note" name="description" class="form-control" rows="3" placeholder="Thông tin chi tiết từ hóa đơn..."></textarea>
                </div>

                <div style="margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="width: 100%; padding: 12px; font-weight: bold; font-size: 1rem;">
                        Xác nhận & Lưu vào Thu Chi
                    </button>
                    <button type="button" onclick="window.location.reload()" class="btn btn-secondary" style="width: 100%; margin-top: 10px; background: none; color: #64748b; border: 1px solid #cbd5e1;">
                        Hủy kết quả
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    @keyframes scanning {
        0% { top: 0%; }
        50% { top: 100%; }
        100% { top: 0%; }
    }
    
    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        margin-top: 5px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }

    /* Hiệu ứng focus cho input */
    .form-control:focus {
        border-color: #667eea;
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
</style>
{% endblock %}
